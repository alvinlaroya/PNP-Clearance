"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _Credentials = _interopRequireDefault(require("./Credentials"));

var _JwtGenerator = _interopRequireDefault(require("./JwtGenerator"));

var _HashGenerator = _interopRequireDefault(require("./HashGenerator"));

var _Message = _interopRequireDefault(require("./Message"));

var _Voice = _interopRequireDefault(require("./Voice"));

var _Number = _interopRequireDefault(require("./Number"));

var _Verify = _interopRequireDefault(require("./Verify"));

var _NumberInsight = _interopRequireDefault(require("./NumberInsight"));

var _App = _interopRequireDefault(require("./App"));

var _Account = _interopRequireDefault(require("./Account"));

var _CallsResource = _interopRequireDefault(require("./CallsResource"));

var _FilesResource = _interopRequireDefault(require("./FilesResource"));

var _Conversion = _interopRequireDefault(require("./Conversion"));

var _Media = _interopRequireDefault(require("./Media"));

var _Redact = _interopRequireDefault(require("./Redact"));

var _Pricing = _interopRequireDefault(require("./Pricing"));

var _HttpClient = _interopRequireDefault(require("./HttpClient"));

var _NullLogger = _interopRequireDefault(require("./NullLogger"));

var _ConsoleLogger = _interopRequireDefault(require("./ConsoleLogger"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var jwtGeneratorInstance = new _JwtGenerator.default();
var hashGeneratorInstance = new _HashGenerator.default();

class Vonage {
  /**
   * @param {Credentials} credentials - Vonage API credentials
   * @param {string} credentials.apiKey - the Vonage API key
   * @param {string} credentials.apiSecret - the Vonage API secret
   * @param {Object} options - Additional options
   * @param {boolean} options.debug - `true` to turn on debug logging
   * @param {Object} options.logger - Set a custom logger.
   * @param {string} options.appendToUserAgent - A value to append to the user agent.
   *                    The value will be prefixed with a `/`
   */
  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      debug: false
    };
    this.credentials = _Credentials.default.parse(credentials);
    this.options = Object.assign({}, options); // If no logger has been supplied but debug has been set
    // default to using the ConsoleLogger

    if (!this.options.logger && this.options.debug) {
      this.options.logger = new _ConsoleLogger.default();
    } else if (!this.options.logger) {
      // Swallow the logging
      this.options.logger = new _NullLogger.default();
    }

    var userAgent = "@vonage/server-sdk/UNKNOWN node/UNKNOWN";

    try {
      var packageDetails = require(_path.default.join(__dirname, "..", "package.json"));

      userAgent = "@vonage/server-sdk/".concat(packageDetails.version, " node/").concat(process.version.replace("v", ""));
    } catch (e) {
      console.warn("Could not load package details");
    }

    this.options.userAgent = userAgent;

    if (this.options.appendToUserAgent) {
      this.options.userAgent += " ".concat(this.options.appendToUserAgent);
    } // This is legacy, everything should use rest or api going forward


    this.options.httpClient = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials); // We have two different hosts, so we use two different HttpClients

    this.options.api = new _HttpClient.default(Object.assign({
      host: this.options.apiHost || "api.nexmo.com"
    }, this.options), this.credentials);
    this.options.rest = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials);
    this.message = new _Message.default(this.credentials, this.options);
    this.voice = new _Voice.default(this.credentials, this.options);
    this.number = new _Number.default(this.credentials, this.options);
    this.verify = new _Verify.default(this.credentials, this.options);
    this.numberInsight = new _NumberInsight.default(this.credentials, this.options);
    this.applications = new _App.default(this.credentials, this.options);
    this.account = new _Account.default(this.credentials, this.options);
    this.calls = new _CallsResource.default(this.credentials, this.options);
    this.files = new _FilesResource.default(this.credentials, this.options);
    this.conversion = new _Conversion.default(this.credentials, this.options);
    this.media = new _Media.default(this.credentials, this.options);
    this.redact = new _Redact.default(this.credentials, this.options);
    this.pricing = new _Pricing.default(this.credentials, this.options);
    /**
     * @deprecated Please use vonage.applications
     */

    this.app = this.applications;
  }
  /**
   * Generate a JSON Web Token (JWT).
   *
   * The private key used upon Vonage instance construction will be used to sign
   * the JWT. The application_id you used upon Vonage instance creation will be
   * included in the claims for the JWT, however this can be overridden by passing
   * an application_id as part of the claims.
   *
   * @param {Object} claims - name/value pair claims to sign within the JWT
   *
   * @returns {String} the generated token
   */


  generateJwt() {
    var claims = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    if (claims.application_id === undefined) {
      claims.application_id = this.credentials.applicationId;
    }

    return Vonage.generateJwt(this.credentials.privateKey, claims);
  }
  /**
   * Generate a Signature Hash.
   *
   * @param {Object} params - params to generate hash from
   *
   * @returns {String} the generated token
   */


  generateSignature(params) {
    return this.credentials.generateSignature(params);
  }

}
/**
 * Generate a JSON Web Token (JWT).
 *
 * @param {String|Buffer} privateKey - the path to the private key certificate
 *          to be used when signing the claims.
 * @param {Object} claims - name/value pair claims to sign within the JWT
 *
 * @returns {String} the generated token
 */


Vonage.generateJwt = (privateKey, claims) => {
  if (!(privateKey instanceof Buffer)) {
    if (!_fs.default.existsSync(privateKey)) {
      throw new Error("File \"".concat(privateKey, "\" not found."));
    } else {
      privateKey = _fs.default.readFileSync(privateKey);
    }
  }

  return jwtGeneratorInstance.generate(privateKey, claims);
};
/**
 * Generate a Signature Hash.
 *
 * @param {String} method - the method to be used when creating the hash
 * @param {String} secret - the secret to be used when creating the hash
 * @param {Object} params - params to generate hash from
 *
 * @returns {String} the generated token
 */


Vonage.generateSignature = (method, secret, params) => {
  return hashGeneratorInstance.generate(method, secret, params);
};

var _default = Vonage;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Wb25hZ2UuanMiXSwibmFtZXMiOlsiand0R2VuZXJhdG9ySW5zdGFuY2UiLCJKd3RHZW5lcmF0b3IiLCJoYXNoR2VuZXJhdG9ySW5zdGFuY2UiLCJIYXNoR2VuZXJhdG9yIiwiVm9uYWdlIiwiY29uc3RydWN0b3IiLCJjcmVkZW50aWFscyIsIm9wdGlvbnMiLCJkZWJ1ZyIsIkNyZWRlbnRpYWxzIiwicGFyc2UiLCJPYmplY3QiLCJhc3NpZ24iLCJsb2dnZXIiLCJDb25zb2xlTG9nZ2VyIiwiTnVsbExvZ2dlciIsInVzZXJBZ2VudCIsInBhY2thZ2VEZXRhaWxzIiwicmVxdWlyZSIsInBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwidmVyc2lvbiIsInByb2Nlc3MiLCJyZXBsYWNlIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiYXBwZW5kVG9Vc2VyQWdlbnQiLCJodHRwQ2xpZW50IiwiSHR0cENsaWVudCIsImhvc3QiLCJyZXN0SG9zdCIsImFwaSIsImFwaUhvc3QiLCJyZXN0IiwibWVzc2FnZSIsIk1lc3NhZ2UiLCJ2b2ljZSIsIlZvaWNlIiwibnVtYmVyIiwiTnVtYmVyIiwidmVyaWZ5IiwiVmVyaWZ5IiwibnVtYmVySW5zaWdodCIsIk51bWJlckluc2lnaHQiLCJhcHBsaWNhdGlvbnMiLCJBcHAiLCJhY2NvdW50IiwiQWNjb3VudCIsImNhbGxzIiwiQ2FsbHNSZXNvdXJjZSIsImZpbGVzIiwiRmlsZXNSZXNvdXJjZSIsImNvbnZlcnNpb24iLCJDb252ZXJzaW9uIiwibWVkaWEiLCJNZWRpYSIsInJlZGFjdCIsIlJlZGFjdCIsInByaWNpbmciLCJQcmljaW5nIiwiYXBwIiwiZ2VuZXJhdGVKd3QiLCJjbGFpbXMiLCJhcHBsaWNhdGlvbl9pZCIsInVuZGVmaW5lZCIsImFwcGxpY2F0aW9uSWQiLCJwcml2YXRlS2V5IiwiZ2VuZXJhdGVTaWduYXR1cmUiLCJwYXJhbXMiLCJCdWZmZXIiLCJmcyIsImV4aXN0c1N5bmMiLCJFcnJvciIsInJlYWRGaWxl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O0FBQ0xBLE1BQUFBLFVBQVUsR0FBR0ksWUFBR0csWUFBSCxDQUFnQlAsVUFBaEIsQ0FBYjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT3BFLG9CQUFvQixDQUFDNEUsUUFBckIsQ0FBOEJSLFVBQTlCLEVBQTBDSixNQUExQyxDQUFQO0FBQ0QsQ0FURDtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E1RCxNQUFNLENBQUNpRSxpQkFBUCxHQUEyQixDQUFDUSxNQUFELEVBQVNDLE1BQVQsRUFBaUJSLE1BQWpCLEtBQTRCO0FBQ3JELFNBQU9wRSxxQkFBcUIsQ0FBQzBFLFFBQXRCLENBQStCQyxNQUEvQixFQUF1Q0MsTUFBdkMsRUFBK0NSLE1BQS9DLENBQVA7QUFDRCxDQUZEOztlQUllbEUsTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5cbmltcG9ydCBDcmVkZW50aWFscyBmcm9tIFwiLi9DcmVkZW50aWFsc1wiO1xuaW1wb3J0IEp3dEdlbmVyYXRvciBmcm9tIFwiLi9Kd3RHZW5lcmF0b3JcIjtcbmltcG9ydCBIYXNoR2VuZXJhdG9yIGZyb20gXCIuL0hhc2hHZW5lcmF0b3JcIjtcbmltcG9ydCBNZXNzYWdlIGZyb20gXCIuL01lc3NhZ2VcIjtcbmltcG9ydCBWb2ljZSBmcm9tIFwiLi9Wb2ljZVwiO1xuaW1wb3J0IE51bWJlciBmcm9tIFwiLi9OdW1iZXJcIjtcbmltcG9ydCBWZXJpZnkgZnJvbSBcIi4vVmVyaWZ5XCI7XG5pbXBvcnQgTnVtYmVySW5zaWdodCBmcm9tIFwiLi9OdW1iZXJJbnNpZ2h0XCI7XG5pbXBvcnQgQXBwIGZyb20gXCIuL0FwcFwiO1xuaW1wb3J0IEFjY291bnQgZnJvbSBcIi4vQWNjb3VudFwiO1xuaW1wb3J0IENhbGxzUmVzb3VyY2UgZnJvbSBcIi4vQ2FsbHNSZXNvdXJjZVwiO1xuaW1wb3J0IEZpbGVzUmVzb3VyY2UgZnJvbSBcIi4vRmlsZXNSZXNvdXJjZVwiO1xuaW1wb3J0IENvbnZlcnNpb24gZnJvbSBcIi4vQ29udmVyc2lvblwiO1xuaW1wb3J0IE1lZGlhIGZyb20gXCIuL01lZGlhXCI7XG5pbXBvcnQgUmVkYWN0IGZyb20gXCIuL1JlZGFjdFwiO1xuaW1wb3J0IFByaWNpbmcgZnJvbSBcIi4vUHJpY2luZ1wiO1xuaW1wb3J0IEh0dHBDbGllbnQgZnJvbSBcIi4vSHR0cENsaWVudFwiO1xuaW1wb3J0IE51bGxMb2dnZXIgZnJvbSBcIi4vTnVsbExvZ2dlclwiO1xuaW1wb3J0IENvbnNvbGVMb2dnZXIgZnJvbSBcIi4vQ29uc29sZUxvZ2dlclwiO1xuXG5jb25zdCBqd3RHZW5lcmF0b3JJbnN0YW5jZSA9IG5ldyBKd3RHZW5lcmF0b3IoKTtcbmNvbnN0IGhhc2hHZW5lcmF0b3JJbnN0YW5jZSA9IG5ldyBIYXNoR2VuZXJhdG9yKCk7XG5cbmNsYXNzIFZvbmFnZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge0NyZWRlbnRpYWxzfSBjcmVkZW50aWFscyAtIFZvbmFnZSBBUEkgY3JlZGVudGlhbHNcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNyZWRlbnRpYWxzLmFwaUtleSAtIHRoZSBWb25hZ2UgQVBJIGtleVxuICAgKiBAcGFyYW0ge3N0cmluZ30gY3JlZGVudGlhbHMuYXBpU2VjcmV0IC0gdGhlIFZvbmFnZSBBUEkgc2VjcmV0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gQWRkaXRpb25hbCBvcHRpb25zXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5kZWJ1ZyAtIGB0cnVlYCB0byB0dXJuIG9uIGRlYnVnIGxvZ2dpbmdcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMubG9nZ2VyIC0gU2V0IGEgY3VzdG9tIGxvZ2dlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuYXBwZW5kVG9Vc2VyQWdlbnQgLSBBIHZhbHVlIHRvIGFwcGVuZCB0byB0aGUgdXNlciBhZ2VudC5cbiAgICogICAgICAgICAgICAgICAgICAgIFRoZSB2YWx1ZSB3aWxsIGJlIHByZWZpeGVkIHdpdGggYSBgL2BcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0geyBkZWJ1ZzogZmFsc2UgfSkge1xuICAgIHRoaXMuY3JlZGVudGlhbHMgPSBDcmVkZW50aWFscy5wYXJzZShjcmVkZW50aWFscyk7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyk7XG5cbiAgICAvLyBJZiBubyBsb2dnZXIgaGFzIGJlZW4gc3VwcGxpZWQgYnV0IGRlYnVnIGhhcyBiZWVuIHNldFxuICAgIC8vIGRlZmF1bHQgdG8gdXNpbmcgdGhlIENvbnNvbGVMb2dnZXJcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5sb2dnZXIgJiYgdGhpcy5vcHRpb25zLmRlYnVnKSB7XG4gICAgICB0aGlzLm9wdGlvbnMubG9nZ2VyID0gbmV3IENvbnNvbGVMb2dnZXIoKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdGlvbnMubG9nZ2VyKSB7XG4gICAgICAvLyBTd2FsbG93IHRoZSBsb2dnaW5nXG4gICAgICB0aGlzLm9wdGlvbnMubG9nZ2VyID0gbmV3IE51bGxMb2dnZXIoKTtcbiAgICB9XG5cbiAgICBsZXQgdXNlckFnZW50ID0gXCJAdm9uYWdlL3NlcnZlci1zZGsvVU5LTk9XTiBub2RlL1VOS05PV05cIjtcbiAgICB0cnkge1xuICAgICAgdmFyIHBhY2thZ2VEZXRhaWxzID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uXCIsIFwicGFja2FnZS5qc29uXCIpKTtcbiAgICAgIHVzZXJBZ2VudCA9IGBAdm9uYWdlL3NlcnZlci1zZGsvJHtcbiAgICAgICAgcGFja2FnZURldGFpbHMudmVyc2lvblxuICAgICAgfSBub2RlLyR7cHJvY2Vzcy52ZXJzaW9uLnJlcGxhY2UoXCJ2XCIsIFwiXCIpfWA7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGxvYWQgcGFja2FnZSBkZXRhaWxzXCIpO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMudXNlckFnZW50ID0gdXNlckFnZW50O1xuICAgIGlmICh0aGlzLm9wdGlvbnMuYXBwZW5kVG9Vc2VyQWdlbnQpIHtcbiAgICAgIHRoaXMub3B0aW9ucy51c2VyQWdlbnQgKz0gYCAke3RoaXMub3B0aW9ucy5hcHBlbmRUb1VzZXJBZ2VudH1gO1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgbGVnYWN5LCBldmVyeXRoaW5nIHNob3VsZCB1c2UgcmVzdCBvciBhcGkgZ29pbmcgZm9yd2FyZFxuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoXG4gICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICB7IGhvc3Q6IHRoaXMub3B0aW9ucy5yZXN0SG9zdCB8fCBcInJlc3QubmV4bW8uY29tXCIgfSxcbiAgICAgICAgdGhpcy5vcHRpb25zXG4gICAgICApLFxuICAgICAgdGhpcy5jcmVkZW50aWFsc1xuICAgICk7XG5cbiAgICAvLyBXZSBoYXZlIHR3byBkaWZmZXJlbnQgaG9zdHMsIHNvIHdlIHVzZSB0d28gZGlmZmVyZW50IEh0dHBDbGllbnRzXG4gICAgdGhpcy5vcHRpb25zLmFwaSA9IG5ldyBIdHRwQ2xpZW50KFxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgeyBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIiB9LFxuICAgICAgICB0aGlzLm9wdGlvbnNcbiAgICAgICksXG4gICAgICB0aGlzLmNyZWRlbnRpYWxzXG4gICAgKTtcbiAgICB0aGlzLm9wdGlvbnMucmVzdCA9IG5ldyBIdHRwQ2xpZW50KFxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgeyBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiIH0sXG4gICAgICAgIHRoaXMub3B0aW9uc1xuICAgICAgKSxcbiAgICAgIHRoaXMuY3JlZGVudGlhbHNcbiAgICApO1xuXG4gICAgdGhpcy5tZXNzYWdlID0gbmV3IE1lc3NhZ2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnZvaWNlID0gbmV3IFZvaWNlKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5udW1iZXIgPSBuZXcgTnVtYmVyKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy52ZXJpZnkgPSBuZXcgVmVyaWZ5KHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5udW1iZXJJbnNpZ2h0ID0gbmV3IE51bWJlckluc2lnaHQodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmFwcGxpY2F0aW9ucyA9IG5ldyBBcHAodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmFjY291bnQgPSBuZXcgQWNjb3VudCh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuY2FsbHMgPSBuZXcgQ2FsbHNSZXNvdXJjZSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuZmlsZXMgPSBuZXcgRmlsZXNSZXNvdXJjZSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuY29udmVyc2lvbiA9IG5ldyBDb252ZXJzaW9uKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5tZWRpYSA9IG5ldyBNZWRpYSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMucmVkYWN0ID0gbmV3IFJlZGFjdCh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMucHJpY2luZyA9IG5ldyBQcmljaW5nKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG5cbiAgICAvKipcbiAgICAgKiBAZGVwcmVjYXRlZCBQbGVhc2UgdXNlIHZvbmFnZS5hcHBsaWNhdGlvbnNcbiAgICAgKi9cbiAgICB0aGlzLmFwcCA9IHRoaXMuYXBwbGljYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgSlNPTiBXZWIgVG9rZW4gKEpXVCkuXG4gICAqXG4gICAqIFRoZSBwcml2YXRlIGtleSB1c2VkIHVwb24gVm9uYWdlIGluc3RhbmNlIGNvbnN0cnVjdGlvbiB3aWxsIGJlIHVzZWQgdG8gc2lnblxuICAgKiB0aGUgSldULiBUaGUgYXBwbGljYXRpb25faWQgeW91IHVzZWQgdXBvbiBWb25hZ2UgaW5zdGFuY2UgY3JlYXRpb24gd2lsbCBiZVxuICAgKiBpbmNsdWRlZCBpbiB0aGUgY2xhaW1zIGZvciB0aGUgSldULCBob3dldmVyIHRoaXMgY2FuIGJlIG92ZXJyaWRkZW4gYnkgcGFzc2luZ1xuICAgKiBhbiBhcHBsaWNhdGlvbl9pZCBhcyBwYXJ0IG9mIHRoZSBjbGFpbXMuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjbGFpbXMgLSBuYW1lL3ZhbHVlIHBhaXIgY2xhaW1zIHRvIHNpZ24gd2l0aGluIHRoZSBKV1RcbiAgICpcbiAgICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICAgKi9cblxuICBnZW5lcmF0ZUp3dChjbGFpbXMgPSB7fSkge1xuICAgIGlmIChjbGFpbXMuYXBwbGljYXRpb25faWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY2xhaW1zLmFwcGxpY2F0aW9uX2lkID0gdGhpcy5jcmVkZW50aWFscy5hcHBsaWNhdGlvbklkO1xuICAgIH1cbiAgICByZXR1cm4gVm9uYWdlLmdlbmVyYXRlSnd0KHRoaXMuY3JlZGVudGlhbHMucHJpdmF0ZUtleSwgY2xhaW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIFNpZ25hdHVyZSBIYXNoLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIC0gcGFyYW1zIHRvIGdlbmVyYXRlIGhhc2ggZnJvbVxuICAgKlxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSB0aGUgZ2VuZXJhdGVkIHRva2VuXG4gICAqL1xuICBnZW5lcmF0ZVNpZ25hdHVyZShwYXJhbXMpIHtcbiAgICByZXR1cm4gdGhpcy5jcmVkZW50aWFscy5nZW5lcmF0ZVNpZ25hdHVyZShwYXJhbXMpO1xuICB9XG59XG5cbi8qKlxuICogR2VuZXJhdGUgYSBKU09OIFdlYiBUb2tlbiAoSldUKS5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ3xCdWZmZXJ9IHByaXZhdGVLZXkgLSB0aGUgcGF0aCB0byB0aGUgcHJpdmF0ZSBrZXkgY2VydGlmaWNhdGVcbiAqICAgICAgICAgIHRvIGJlIHVzZWQgd2hlbiBzaWduaW5nIHRoZSBjbGFpbXMuXG4gKiBAcGFyYW0ge09iamVjdH0gY2xhaW1zIC0gbmFtZS92YWx1ZSBwYWlyIGNsYWltcyB0byBzaWduIHdpdGhpbiB0aGUgSldUXG4gKlxuICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICovXG5Wb25hZ2UuZ2VuZXJhdGVKd3QgPSAocHJpdmF0ZUtleSwgY2xhaW1zKSA9PiB7XG4gIGlmICghKHByaXZhdGVLZXkgaW5zdGFuY2VvZiBCdWZmZXIpKSB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHByaXZhdGVLZXkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGUgXCIke3ByaXZhdGVLZXl9XCIgbm90IGZvdW5kLmApO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcml2YXRlS2V5ID0gZnMucmVhZEZpbGVTeW5jKHByaXZhdGVLZXkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gand0R2VuZXJhdG9ySW5zdGFuY2UuZ2VuZXJhdGUocHJpdmF0ZUtleSwgY2xhaW1zKTtcbn07XG5cbi8qKlxuICogR2VuZXJhdGUgYSBTaWduYXR1cmUgSGFzaC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kIC0gdGhlIG1ldGhvZCB0byBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIGhhc2hcbiAqIEBwYXJhbSB7U3RyaW5nfSBzZWNyZXQgLSB0aGUgc2VjcmV0IHRvIGJlIHVzZWQgd2hlbiBjcmVhdGluZyB0aGUgaGFzaFxuICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyAtIHBhcmFtcyB0byBnZW5lcmF0ZSBoYXNoIGZyb21cbiAqXG4gKiBAcmV0dXJucyB7U3RyaW5nfSB0aGUgZ2VuZXJhdGVkIHRva2VuXG4gKi9cblZvbmFnZS5nZW5lcmF0ZVNpZ25hdHVyZSA9IChtZXRob2QsIHNlY3JldCwgcGFyYW1zKSA9PiB7XG4gIHJldHVybiBoYXNoR2VuZXJhdG9ySW5zdGFuY2UuZ2VuZXJhdGUobWV0aG9kLCBzZWNyZXQsIHBhcmFtcyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBWb25hZ2U7XG4iXX0=